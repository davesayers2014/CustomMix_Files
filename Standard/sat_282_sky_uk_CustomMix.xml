<!-- DSayers Cable channels into Sky UK Custom mix xml file-->
<!-- DATE 20191015 -->
<custommix>
	<inserts>
		<!-- Swap HD channels that don't clear on sat and not available on cable -->
		<insert target="108" source="808" provider="sat_282_sky_uk" ></insert> <!-- Sky Atlantic HD -->
		<insert target="603" source="641" provider="sat_282_sky_uk" ></insert> <!-- boomerang sd -->
		<!-- replace sky hd channels with working ones from cable -->
		<insert target="106" source="109" provider="cable_uk_virgin" ></insert> <!-- sky one hd -->
		<insert target="107" source="111" provider="cable_uk_virgin" ></insert> <!-- sky living hd -->
		<insert target="109" source="211" provider="cable_uk_virgin" ></insert> <!-- watch hd -->
		<insert target="110" source="124" provider="cable_uk_virgin" ></insert> <!-- Gold HD -->
		<insert target="111" source="227" provider="cable_uk_virgin" ></insert> <!-- dave hd -->
		<insert target="112" source="181" provider="cable_uk_virgin" ></insert> <!-- comedy central hd -->
		<insert target="113" source="121" provider="cable_uk_virgin" ></insert> <!-- universal hd -->
		<insert target="114" source="137" provider="cable_uk_virgin" ></insert> <!-- syfy hd -->
		<insert target="118" source="176" provider="cable_uk_virgin" ></insert> <!-- itv2 hd -->
		<insert target="119" source="177" provider="cable_uk_virgin" ></insert> <!-- itv3 hd -->
		<insert target="120" source="178" provider="cable_uk_virgin" ></insert> <!-- itv4 hd -->
		<insert target="121" source="135" provider="cable_uk_virgin" ></insert> <!-- sky crime hd -->
		<insert target="122" source="156" provider="cable_uk_virgin" ></insert> <!-- sky arts 1 hd -->
		<insert target="123" source="140" provider="cable_uk_virgin" ></insert> <!-- E! HD -->
		<insert target="124" source="199" provider="cable_uk_virgin" ></insert> <!-- fox hd -->
		<insert target="125" source="250" provider="cable_uk_virgin" ></insert> <!-- discovery hd -->
		<insert target="126" source="183" provider="cable_uk_virgin" ></insert> <!-- mtv hd -->
		<insert target="129" source="268" provider="cable_uk_virgin" ></insert> <!-- nat geographic hd -->
		<insert target="131" source="179" provider="cable_uk_virgin" ></insert> <!-- itvbe hd -->
		<insert target="132" source="212" provider="cable_uk_virgin" ></insert> <!-- alibi hd -->
		<insert target="133" source="168" provider="cable_uk_virgin" ></insert> <!-- tlc hd -->
		<insert target="135" source="145" provider="cable_uk_virgin" ></insert> <!-- e4 hd -->
		<insert target="136" source="195" provider="cable_uk_virgin" ></insert> <!-- more 4 hd -->
		<insert target="137" source="203" provider="cable_uk_virgin" ></insert> <!-- 4 seven hd -->
		<insert target="145" source="510" provider="cable_uk_virgin" ></insert> <!-- sky sports mix HD -->
		<insert target="156" source="209" provider="cable_uk_virgin" ></insert> <!-- Crime + Investigation HD -->
		<insert target="162" source="251" provider="cable_uk_virgin" ></insert> <!-- animal planet hd -->
		<insert target="163" source="273" provider="cable_uk_virgin" ></insert> <!-- history2 hd -->
		<insert target="165" source="265" provider="cable_uk_virgin" ></insert> <!-- nat geo wild hd -->
		<insert target="166" source="247" provider="cable_uk_virgin" ></insert> <!-- eden hd  -->
		<insert target="176" source="293" provider="cable_uk_virgin" ></insert> <!-- Love Nature HD -->
		<insert target="187" source="208" provider="cable_uk_virgin" ></insert> <!-- lifetime hd -->	
		<insert target="190" source="137" provider="sat_282_sky_uk" ></insert> <!-- 4seven sd -->
		<insert target="198" source="279" provider="cable_uk_virgin" ></insert> <!-- good food hd -->
		<insert target="229" source="267" provider="cable_uk_virgin" ></insert> <!-- nat geo +1 -->
		<insert target="301" source="401" provider="cable_uk_virgin" ></insert> <!-- sky premiere hd -->
		<insert target="302" source="403" provider="cable_uk_virgin" ></insert> <!-- sky hits hd -->
		<insert target="303" source="404" provider="cable_uk_virgin" ></insert> <!-- sky greats hd -->
		<insert target="304" source="405" provider="cable_uk_virgin" ></insert> <!-- sky disney hd -->
		<insert target="305" source="406" provider="cable_uk_virgin" ></insert> <!-- sky family hd -->
		<insert target="306" source="407" provider="cable_uk_virgin" ></insert> <!-- sky action hd -->
		<insert target="307" source="408" provider="cable_uk_virgin" ></insert> <!-- sky comedy hd -->
		<insert target="308" source="409" provider="cable_uk_virgin" ></insert> <!-- sky thriller hd -->
		<insert target="309" source="410" provider="cable_uk_virgin" ></insert> <!-- sky drama  hd -->
		<insert target="310" source="411" provider="cable_uk_virgin" ></insert> <!-- sky scifi hd -->
		<insert target="311" source="412" provider="cable_uk_virgin" ></insert> <!-- sky Classic hd -->
		<insert target="312" source="402" provider="cable_uk_virgin" ></insert> <!-- sky Premiere+1 sd -->
		<insert target="313" source="429" provider="cable_uk_virgin" ></insert> <!-- film4 hd -->
		<insert target="315" source="416" provider="cable_uk_virgin" ></insert> <!-- tcm hd -->
		<insert target="377" source="311" provider="cable_uk_virgin" ></insert> <!-- mtv live hd -->
		<insert target="403" source="503" provider="cable_uk_virgin" ></insert> <!-- sky sports Football HD hd -->
		<insert target="409" source="509" provider="cable_uk_virgin" ></insert> <!-- sky sports News hd -->
		<insert target="410" source="521" provider="cable_uk_virgin" ></insert> <!-- british eurosport hd -->
		<insert target="411" source="522" provider="cable_uk_virgin" ></insert> <!-- british eurosport 2 hd -->
		<insert target="413" source="527" provider="cable_uk_virgin" ></insert> <!-- bt sports 1 hd -->
		<insert target="414" source="528" provider="cable_uk_virgin" ></insert> <!-- bt sports 2 hd -->
		<insert target="417" source="529" provider="cable_uk_virgin" ></insert> <!-- bt sports 3 hd -->
		<insert target="423" source="530" provider="cable_uk_virgin" ></insert> <!-- bt sports/espn hd -->
		<insert target="472" source="413" provider="sat_282_sky_uk" ></insert> <!-- BT Sport 1 sd -->
		<insert target="473" source="414" provider="sat_282_sky_uk" ></insert> <!-- BT Sport 2 sd -->
		<insert target="474" source="417" provider="sat_282_sky_uk" ></insert> <!-- BT Sport 3 sd -->
		<insert target="475" source="423" provider="sat_282_sky_uk" ></insert> <!-- BT Sport/espn sd -->
		<insert target="491" source="1000" provider="cable_uk_virgin" ></insert> <!-- Virgin Sky Events -->
		<insert target="501" source="602" provider="cable_uk_virgin" ></insert> <!-- sky news hd -->
		<insert target="601" source="732" provider="cable_uk_virgin" ></insert> <!-- cn hd -->
		<insert target="604" source="714" provider="cable_uk_virgin" ></insert> <!-- nickelodeon hd -->
		<insert target="649" source="739" provider="cable_uk_virgin" ></insert> <!-- ZooMoo HD -->
		<insert target="703" source="805" provider="cable_uk_virgin" ></insert> <!-- SONY TV HD -->
		<insert target="705" source="803" provider="cable_uk_virgin" ></insert> <!-- Star +1 hd -->
		<insert target="709" source="809" provider="cable_uk_virgin" ></insert> <!-- Zee TV HD -->
		<insert target="713" source="841" provider="cable_uk_virgin" ></insert> <!-- MTV Beats -->
		<insert target="717" source="801" provider="cable_uk_virgin" ></insert> <!-- Star Gold hd -->
		<insert target="715" source="806" provider="cable_uk_virgin" ></insert> <!-- Sony Max hd -->
		<insert target="1010" source="1003" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 1 -->
		<insert target="1011" source="1004" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 2 -->
		<insert target="1012" source="1005" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 3 -->
		<insert target="1013" source="1006" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 4 -->
		<insert target="1014" source="1007" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 5 -->
		<insert target="1015" source="1008" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 6 -->
		<insert target="1016" source="1009" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 7 -->
		<insert target="1017" source="1010" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 8 -->
		<insert target="1018" source="1011" provider="cable_uk_virgin" ></insert> <!-- Virgin Events 9 -->

		<!-- replace dead sky sd channels with working ones from cable -->
		<insert target="130" source="270" provider="cable_uk_virgin" ></insert> <!-- History TV -->
		<insert target="156" source="275" provider="cable_uk_virgin" ></insert> <!-- Crme and Inv -->
		<insert target="170" source="160" provider="cable_uk_virgin" ></insert> <!-- Sky Two sd -->
		<insert target="210" source="194" provider="cable_uk_virgin" ></insert> <!-- Gold+1 -->
		<insert target="224" source="158" provider="cable_uk_virgin" ></insert> <!-- Fox +1 sd -->
		<insert target="207" source="140" provider="cable_uk_virgin" ></insert> <!-- Sky Living +1 sd -->
		<insert target="230" source="271" provider="cable_uk_virgin" ></insert> <!-- History TV +1 -->
		<insert target="270" source="207" provider="cable_uk_virgin" ></insert> <!-- Real Lives +1 -->
		<insert target="312" source="402" provider="cable_uk_virgin" ></insert> <!-- sky premiere +1 -->
		<insert target="412" source="551" provider="cable_uk_virgin" ></insert> <!-- premier sports hd -->
		<insert target="422" source="553" provider="cable_uk_virgin" ></insert> <!-- freesports hd -->
		<insert target="425" source="544" provider="cable_uk_virgin" ></insert> <!-- LFCTV -->
		<insert target="605" source="713" provider="cable_uk_virgin" ></insert> <!-- Nickelodeon +1 -->
		<insert target="607" source="727" provider="cable_uk_virgin" ></insert> <!-- disny Jnr -->
		<insert target="609" source="724" provider="cable_uk_virgin" ></insert> <!-- disny channel -->
		<insert target="610" source="725" provider="cable_uk_virgin" ></insert> <!-- disny channel +1 -->
		<insert target="611" source="707" provider="cable_uk_virgin" ></insert> <!-- disny xd -->
		<insert target="612" source="708" provider="cable_uk_virgin" ></insert> <!-- disny xd +1 -->
		<insert target="619" source="706" provider="cable_uk_virgin" ></insert> <!-- cartoonito -->
		<insert target="622" source="703" provider="cable_uk_virgin" ></insert> <!-- BabyTV -->
		<insert target="707" source="810" provider="cable_uk_virgin" ></insert> <!-- Zee Cinema -->
		<insert target="819" source="520" provider="cable_uk_virgin" ></insert> <!-- sky sports Mix sd -->
		<insert target="863" source="509" provider="cable_uk_virgin" ></insert> <!-- sky sports News sd -->
	</inserts>
	<deletes>
		<!-- Delete channels that have been swapped, to remove duplication -->
		<delete target="490"></delete> <!-- BTSptBoxOffHD -->
		<delete target="493"></delete> <!-- ITV Box Office -->
		<delete target="835"></delete> <!-- Crime & Investigation -->
		<delete target="641"></delete> <!-- boomerang sd -->
		<delete target="643"></delete> <!-- Disney Jnr -->
		<delete target="644"></delete> <!-- Disney Channel -->
		<delete target="645"></delete> <!-- Disney XD -->
		<delete target="648"></delete> <!-- Nick Jnr -->
		<delete target="808"></delete> <!-- Sky Atlantic -->
		<delete target="810"></delete> <!-- Gold -->
		<delete target="825"></delete> <!-- History -->
		<delete target="834"></delete> <!-- E! -->
		<delete target="842"></delete> <!-- Sky PremiereHD -->
		<delete target="843"></delete> <!-- Sky Hits HD -->
		<delete target="844"></delete> <!-- Sky Superhero HD -->
		<delete target="845"></delete> <!-- Sky Disney HD -->
		<delete target="846"></delete> <!-- Sky Family HD -->
		<delete target="847"></delete> <!-- Sky Action HD -->
		<delete target="848"></delete> <!-- Sky Comedy HD -->
		<delete target="849"></delete> <!-- Sky Thriller HD -->
		<delete target="850"></delete> <!-- Sky Drama HD -->
		<delete target="851"></delete> <!-- Sky ScFi/Hur HD -->
		<delete target="852"></delete> <!-- Sky Classics HD -->
		<delete target="855"></delete> <!-- Sky Sports Main Event -->
		<delete target="856"></delete> <!-- Sky Sports PL -->
		<delete target="857"></delete> <!-- Sky Sports Football -->
		<delete target="858"></delete> <!-- Sky Sports Cricket -->
		<delete target="859"></delete> <!-- Sky Sports Golf -->
		<delete target="860"></delete> <!-- Sky Sports F1t -->
		<delete target="861"></delete> <!-- Sky Sports Action -->
		<delete target="862"></delete> <!-- Sky Sports Arena -->
		<delete target="867"></delete> <!-- BT Sport 1 HD  -->
		<delete target="868"></delete> <!-- BT Sport 2 HD  -->
		<delete target="869"></delete> <!-- BT Sport 3 HD  -->
		<delete target="872"></delete> <!-- BT Sport/ESPN HD  -->
		<delete target="873"></delete> <!-- LFCTV -->
		<delete target="888"></delete> <!-- Sky Sports Racing -->
	</deletes>
	<hacks>
<![CDATA[

rename = {
	# ITV regions
	5070: "STV 2",
	6210: "STV North (Grampian)",
	6220: "STV Scottish West",
	6325: "STV North (Dundee)",
}

channels_to_add_by_id = {
	1163: 421, # eir Sport 1 HD (also 1042)
	5152: 424, # eir Sport 2 HD (also 5154)
	5122: 428, # eir Sport 1 (also 3601)
	5123: 460, # eir Sport 2 (also 4551)
	1078: 988, # "Made In Birmingham"
	1016: 989, # "Made In Liverpool"
	5090: 990, # "London Live"
	5070: 991, # "STV Glasgow"
	3527: 992, # "STV Edinburgh"
	5315: 993, # "Made In Bristol"
	5537: 994, # "Made In Leeds"
	5536: 995, # "Made In Cardiff"
	5043: 996, # "Made In Tn&Wr"
	5421: 997, # "Notts TV"
	#alternatives
	2709: 127, # ComedyXtra
	3705: 812, # ComedyCentral
	5527: 606, # Nicktoons
	3356: 615, # Nick Jr
	2517: 642, # Nicelodeon
}

broken_TSIDS = [
	2007, #7d7 20170518
	2011, #7db 20170425
	2012, #7dc 20170518
	2019, #7e3 20170518
	2021, #7e5 20170516
	2023, #7e7 20170331
	2025, #7e9 20170518
	2026, #7ea 20170425
	2029, #7ed 20170516
]

# Channel renames
for service in sorted(customised["video"].keys()):
	if "channel_id" in customised["video"][service] and customised["video"][service]["channel_id"] in rename:
		customised["video"][service]["interactive_name"] = rename[customised["video"][service]["channel_id"]]

# Add channels by ID
for service in sorted(customised["video"].keys()):
	if "channel_id" in customised["video"][service] and customised["video"][service]["channel_id"] in channels_to_add_by_id:
		customised["video"][channels_to_add_by_id[customised["video"][service]["channel_id"]]] = customised["video"][service]
		del customised["video"][service]

# Remove encrypted services from certain transport streams (will still be in lamedb)
for service in sorted(customised["video"].keys()):
	if customised["video"][service]["transport_stream_id"] in broken_TSIDS and customised["video"][service]["free_ca"] != 0:
		del customised["video"][service]

# Add ITV regions Bouquet
ITVs = []
ITVsPlusOne = []
rest = []
last_section = max(sections.keys())
last_section_name = sections[last_section]

for service in sorted(services["sat_282_sky_uk"]["video"].keys()):
	if service in range(last_section, 1450) or service in [103, 133, 178]:
		# ITV regions
		if 'interactive_name' in services["sat_282_sky_uk"]["video"][service] and (service in [103,178] or (service in range(last_section, 1450) and '+1' not in services["sat_282_sky_uk"]["video"][service]["interactive_name"] and ('ITV' in services["sat_282_sky_uk"]["video"][service]["interactive_name"] or 'STV' in services["sat_282_sky_uk"]["video"][service]["interactive_name"] or 'UTV' in services["sat_282_sky_uk"]["video"][service]["interactive_name"]))):
			ITVs.append(services["sat_282_sky_uk"]["video"][service])

		# ITV +1 regions
		elif 'interactive_name' in services["sat_282_sky_uk"]["video"][service] and (service in [133] or (service in range(last_section, 1450) and '+1' in services["sat_282_sky_uk"]["video"][service]["interactive_name"] and ('ITV' in services["sat_282_sky_uk"]["video"][service]["interactive_name"] or 'STV' in services["sat_282_sky_uk"]["video"][service]["interactive_name"] or 'UTV' in services["sat_282_sky_uk"]["video"][service]["interactive_name"]))):
			ITVsPlusOne.append(services["sat_282_sky_uk"]["video"][service])

		else:
			rest.append(services["sat_282_sky_uk"]["video"][service])

i = last_section
sections[i] = "ITV Regions"

sort_list = []
for x in ITVs:
	sort_list.append((x, re.sub('^(?![a-z])', 'zzzzz', x['interactive_name'].lower())))
sort_list = sorted(sort_list, key=lambda listItem: listItem[1])
for service in sort_list:
	customised["video"][i] = service[0]
	i += 1

sort_list = []
for x in ITVsPlusOne:
	sort_list.append((x, re.sub('^(?![a-z])', 'zzzzz', x['interactive_name'].lower())))
sort_list = sorted(sort_list, key=lambda listItem: listItem[1])
for service in sort_list:
	customised["video"][i] = service[0]
	i += 1

sections[i] = last_section_name
sort_list = []
for x in rest:
	sort_list.append((x, re.sub('^(?![a-z])', 'zzzzz', x['service_name'].lower())))
sort_list = sorted(sort_list, key=lambda listItem: listItem[1])
for service in sort_list:
	customised["video"][i] = service[0]
	i += 1

# Create csv file in /tmp directory
def sortDictFlatAlpha(services):
	# services is a dict with LCNs as keys
	# returns keys, sorted flat alphabetic by service name (or interactive name if it is set).
	import re
	sort_list = []
	for lcn in services:
		if "interactive_name" in services[lcn]:
			sort_list.append((lcn, re.sub('^(?![a-z])', 'zzzzz', services[lcn]['interactive_name'].lower())))
		else:
			sort_list.append((lcn, re.sub('^(?![a-z])', 'zzzzz', services[lcn]['service_name'].lower())))
	sort_list = sorted(sort_list, key=lambda listItem: listItem[1])
	return [i[0] for i in sort_list]

def today():
	import datetime
	return datetime.date.today().strftime('%Y%m%d%H%M%S')

def rightNow():
	import datetime
	return datetime.datetime.now().strftime('%Y%m%d%H%M%S')

csv = ["Name,Service ref,DVB Name,LCN,CHID,CA,Provider,SID,TSID,Service type,IPTV_link,Ocram_SRP\r\n"]

control_chars = ''.join(map(unichr, range(0,32) + range(127,160)))
control_char_re = re.compile('[%s]' % re.escape(control_chars))

for number in sortDictFlatAlpha(customised["video"]):
	interactive_name = customised["video"][number]["service_name"]
	if 'interactive_name' in customised["video"][number]:
		interactive_name = customised["video"][number]["interactive_name"]
	interactive_name = control_char_re.sub('', interactive_name).decode('latin-1').encode("utf8")
	channel_id = ""
	if 'channel_id' in customised["video"][number]:
		channel_id = str(customised["video"][number]["channel_id"])
	csv.append('%s,1:0:%s:%s:%s:%s:%s:0:0:0:,%s,%d,%s,%d,%s,0x%x,0x%x,%d,#SERVICE 4097:0:%x:%x:%x:%x:%x:0:0:0:,%s_%s_%s_%s\r\n' % (
					interactive_name,
#Service ref
					str("%x"%customised["video"][number]["service_type"]).upper(),
					str("%x"%customised["video"][number]["service_id"]).upper(),
					str("%x"%customised["video"][number]["transport_stream_id"]).upper(),
					str("%x"%customised["video"][number]["original_network_id"]).upper(),
					str("%x"%customised["video"][number]["namespace"]).upper(),
#DVB Name
					customised["video"][number]["service_name"],
					number,
					channel_id,
					customised["video"][number]["free_ca"],
					customised["video"][number]["provider_name"],
					customised["video"][number]["service_id"],
					customised["video"][number]["transport_stream_id"],
					customised["video"][number]["service_type"],
#IPTV_link
					customised["video"][number]["service_type"],
					customised["video"][number]["service_id"],
					customised["video"][number]["transport_stream_id"],
					customised["video"][number]["original_network_id"],
					customised["video"][number]["namespace"],
#OCRAM_SRP
					str("%x"%customised["video"][number]["service_id"]).upper(),
					str("%x"%customised["video"][number]["transport_stream_id"]).upper(),
					str("%x"%customised["video"][number]["original_network_id"]).upper(),
					str("%x"%customised["video"][number]["namespace"]).upper()
				))
with open("/tmp/0282_sky_GBR-" + rightNow() + ".csv", "w") as csv_file:
	csv_file.write(''.join(csv))

]]>
    </hacks>
	<instructions>
<![CDATA[

----------------------------------------------------------

ABM Providers Setup screen:

info = "- Reccomended for Dsayers Virgin UK into Sky UK\n"
info += "- AutoBouquetsMaker, Configure 'not indexed' channels yes\n\n"
info += "- All providers need to be no apart from Sky UK and virgin UK needs to be yes\n"
info += "- Sky uk: area HD not SD Custom or SD\n"
info += "-Generate bouquets yes (generate main bouquet optional)\n"
info += "-Channel swap to optional\n"
info += "-Virgin uk: yes\n"
info += "-Generate bouquets yes\n"
info += "-Virgin generate bouquets to no unless you use epgrefresh change to yes\n"
info += "-Channel swap to optional\n\n"
info += "-Providers order Sky UK on top\n"

----------------------------------------------------------

ABM configure screen:

Include 'not indexed' channels - Yes

----------------------------------------------------------

Providers order screen:

Sky UK on top

----------------------------------------------------------

]]>
	</instructions>
</custommix>
